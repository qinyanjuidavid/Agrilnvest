{%extends 'accounts/try.html'%}
{%load humanize%}
{%load static%}
{%load crispy_forms_tags%}
{%block title%}
Details
{%endblock%}
{%block current%}
Supplier Details
{%endblock%}
{%block message%}
Welcome To Jambo Farmers,
{%endblock%}
{%block content%}
<div class="container">
<div class="row mt-4">
<div class="col-sm-9">
  <div class="col-md-12 p-3 bg-white mb-3">
    <div class="row">
      <div class="col-md-2">
        <img src="{{dealer.profile_picture.url}}" height=100px width=100px alt="">
      </div>
      <div class="col-md-10">
        {%if dealer.user.full_name%}
        <h5 class="mt-2"><i class="fa fa-user fa-lg"></i> <b>{{dealer.user.full_name|title}}</b></h5>
        {%endif%}
        {%if dealer.county%}
        <h5><span class="icon-my_location"></span> {{dealer.county|title}}, Kenya</h5>
        {%endif%}
      </div>
      </div>
        <hr>
        {%if dealer.user.timestamp%}
        <p class="text-muted"><i class="fa fa-clock-o"></i> Joined {{dealer.user.timestamp|timesince}} ago</p>
        {%endif%}
        <div class="card mt-2 mb-4">
          <div class="card-header border-success">
            <h5>ABOUT</h5>
          </div>
          <div class="card-body">
            {%if dealer.bio%}
            {{dealer.bio|title}}
            {%endif%}
          </div>
        </div>
        <h5 class="ml-2">ADDITIONAL DETAILS</h5>
        <hr>
        <div class="row">
          <div class="col-sm-7">
              <ul class="pl-3" style=list-style-type:none;>
                <div class="card col-sm-10 border-success" style=border-radius:8px;>
                  {%if dealer.category.category%}
                 <li class="m-2"><b>CATEGORY:</b><span class="badge badge-warning badge-lg float-right"> {{dealer.category.category|title}}</span></li>
                 {%endif%}
                  <li class="m-2"><b>RATING:</b><span class="mr-5"> </span></li>
                  {%if dealer.derivery%}
                  <li class="m-2"><b>DERIVERY:</b><span class="badge badge-warning badge-lg float-right"> {{dealer.derivery|title}}</span></li>
                  {%endif%}
                  {%if dealer.response%}
                <li class="m-2"><b>RESPONSE TIME:</b><span class="badge badge-warning float-right">{{dealer.response|title}} </span></li>
                {%endif%}
                <p></p>
              </div>
          
            </ul>
          </div>
          <div class="col-sm-5">
           
            <p>
            <a href="tel:{{dealer.user.phone}}">
            <button class="btn btn-success col-sm-5 mt-2"><i class="fa fa-phone"></i></button>
            </a>
            <hr>
          </p>
<!-- ==================================Rating================================= -->
          <style type="text/css">
          .checked{
            color:orange;
          }
          .my-btn{
            background-color:inherit !important;
            border:0 !important;
          }
          </style>

          <div class="text-left">
            <form class="rate-form" action="" method="POST" id="{{ dealer.pk }}">
            {%csrf_token%}
            <button type="submit" class="fa fa-star fa-2x my-btn" id="first"></button>
            <button type="submit" class="fa fa-star fa-2x my-btn" id="second"></button>
            <button type="submit" class="fa fa-star fa-2x my-btn" id="third"></button>
            <button type="submit" class="fa fa-star fa-2x my-btn" id="fourth"></button>
            <button type="submit" class="fa fa-star fa-2x my-btn" id="fifth"></button>
            </form>
            <br>
            <div id="confirm-box"></div>
            </div>

 <!-- ======================================================================== -->
          <p><i class="fa fa-exclamation-circle text-danger"></i> <small><b>REPORT ABUSE</b></small></p>
          </div>
        </div>
     </div>

  <div class="col-md-12 p-3 bg-white mb-3">
    <legend class="font-weight-bold mb-2"><b style=color:forestgreen;></b> Product(s)</legend>
      <hr>









<div class="container">
     
    <div class="row">

      <div class="col-sm-4">
        <div class="card shadow-lg" style=border-color:white;>
          <img src="" height=150px>
          <div class="p-1">
            <h5 class="text-success"></h5>
            <p class="text-muted"></p>
            <h5><b class="text-primary">1KG @ Ksh. </b></h5>
            <div class="" >

          </div>
          </div>
        </div>
      </div>
    </div>
    </div>


  </div>
   <div class="col-md-12 p-3 bg-white mb-3">
    <legend class="ml-1">0 Report(S)</legend>
    <hr>
   </div>
</div>



<div class="col-sm-3 ">
<div class="p-4 mb-3 bg-white">
  <div class="row">
    <div class="col-sm-4">
  <img src="{{dealer.category.crop_icon.url}}" height=70px width=70px alt="">
</div>
<div class="col-sm-8">
<b></b>
<div class="ml-1 mt-2">
  {%if dealer.level%}
<span class="badge badge-lg badge-primary p-1">{{dealer.level|title}}</span>
{%endif%}
  </div>
</div>
</div>
  <hr>
  <h3 class="h5 text-black mb-3">Contact Info</h3>
   
  <p class="mb-0 font-weight-bold">Location </p>
  <p class="mb-4">
   {{dealer.town|title}} town
  </p>
  <p class="mb-0 font-weight-bold">Phone</p>
  <p class="mb-4">{{dealer.user.phone}}</p>

  <p class="mb-0 font-weight-bold">Email Address</p>
   <p class="mb-0">
    {{dealer.user.email}}
    {% comment %} <span class="__cf_email__" data-cfemail="671e081215020a060e0b2703080a060e094904080a">[email&#160;protected]</span> {% endcomment %}
  </p>
</div>

<div class="p-4 mb-3 bg-white">
  <h3 class="h5 text-black mb-3">About</h3>
  <p></p>
  <p href="#" class="btn btn-primary  py-2 px-4">Learn More</p>
  <hr>
  <div class="" align=center>
  <a href="tel:{{dealer.user.phone}}">
  <button class="btn btn-danger col-sm-12 mb-2"><i class="fa fa-phone"></i> Call/Text Supplier</button>
  </a>
  <a href="mailto:{{dealer.user.email}}">
    <button class="btn btn-primary col-sm-12 mb-2"><i class="fa fa-envelope"></i> Email User</button>
  </a>
  <a href="{%url 'farmers:categoryFilter' dealer.category.category%}">
  <button class="btn btn-primary col-sm-12 mb-2">Related Suppliers</button>
  </a>
</div>
</div>
  </div>

</div>

</div>
 {%endblock%}
{%block javascript%}
<script type="text/javascript">
// Get all the stars
const one=document.getElementById('first')
const two=document.getElementById('second')
const three=document.getElementById('third')
const four=document.getElementById('fourth')
const five=document.getElementById('fifth')
const form=document.querySelector('.rate-form')
const confirmBox=document.getElementById('confirm-box')

const csrf=document.getElementsByName('csrfmiddlewaretoken')

const handleStarSelect=(size)=>{
  const children=form.children
for (let i =0; i<children.length;i++){
  if(i<=size){
    children[i].classList.add('checked')
  }
  else{
    children[i].classList.remove('checked')
  }
}
}

const rating = parseFloat('');
handleStarSelect(Math.round(rating));

const handleSelect=(selection)=>{
  switch(selection){
    case 'first':{
    handleStarSelect(1)
      return
    }

    case 'second':{
      handleStarSelect(2)
      return
    }

    case 'third':{
      handleStarSelect(3)
      return
    }

    case 'fourth':{
      handleStarSelect(4)
      return
    }

    case 'fifth':{
      handleStarSelect(5)
      return
    }
  }
}
const getNumericValue=(stringValue)=>{
  let numericValue;
  if (stringValue==="first"){
    numericValue=1
  }
  else if (stringValue==="second"){
    numericValue=2
  }
  else if (stringValue==='third'){
    numericValue=3
  }
  else if (stringValue==="fourth"){
    numericValue=4
  }
  else if (stringValue==="fifth"){
    numericValue=5
  }
  else {
    numericValue=0
  }
  return numericValue
}

if (one){
  const arr=[one,two,three,four,five];

  arr.forEach(item=> item.addEventListener('mouseover',(event)=>{
    handleSelect(event.target.id)
  }))

  arr.forEach(item=>item.addEventListener('click',(event)=>{
    const val= event.target.id
    console.log(val)

    let isSubmit=false

    form.addEventListener("submit", e =>{
      e.preventDefault()
      if (isSubmit){
        return
      }

      const id = e.target.id;
      console.log(id)
      const val_num=getNumericValue(val)

      $.ajax({
        type:"POST",
        url:"{%url 'farmers:rateFarmer'%}",
        data:{
          'csrfmiddlewaretoken':csrf[0].value,
          'el_id':"{{ dealer.pk }}",
          'customer_id':"{{ user.pk }}",
          'val':val_num,
        },
        success: function(response){
          console.log(response)
          // I would want the alert to popup at the top bg=success

          confirmBox.innerHTML='<h6 class="text-success ml-2">Dealer Successfully Rated '+response.rate+' stars.</h6>'
        },
        error: function(error){
          console.log(error)
          // Same here the popup to appear at the top bg=danger
          confirmBox.innerHTML="<h6 class='text-danger ml-2'>Uuups... Something went wrong</h6>"
        }
      })
    })
  }))
}



</script>
{%endblock%}